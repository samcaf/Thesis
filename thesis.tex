% =====================================
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Setup
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% =====================================
\documentclass[letterpaper,11pt]{book}

\include{includes/paper_preamble}
\include{includes/comment_utils}
\include{includes/thesis_utils}

\bibliographystyle{includes/jhep/JHEP}

\include{includes/glossary}
\makeglossaries{}
 \let\oldGls\gls
 \renewcommand{\gls}[1]{%
    \ifglsused{#1}{ %
        \oldGls{#1}%
    }{%
        \oldGls{#1}%
        \index{\glsentryfirst{#1}}%
    }%
 }

\usepackage[xindy]{imakeidx}
\makeindex

% =====================================
% Misc. utils
% =====================================
% ---------------------------------
% Dark Mode
% --------------------------------
\newif\ifdarkmode{}
\darkmodefalse{}

\ifdarkmode{}
    \pagecolor[rgb]{0,0,0} %black
    \color[rgb]{0.5,0.5,0.5} %grey
\fi

% ---------------------------------
% Colorful Definitions
% ---------------------------------
\newif\ifcolorful{}
\colorfultrue{}

\ifcolorful{}
    \newcommand{\definition}[2]{
\begin{definitionbox}{}{#1}
    #2
\end{definitionbox}
}
\else
    \renewcommand{\definition}[2]{
\begin{definitiontext}
    \label{def:#1}
    #2
\end{definitiontext}
}
\fi


% ---------------------------------
% Final Checks
% ---------------------------------
\newif\ifshowfinalchecks{}
\showfinalchecksfalse{}


% =====================================
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% =====================================


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Front Matter
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\frontmatter{}

% Chapter titles without numbers
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\sffamily}{}{25pt}{\chaptitlenonumber}
\titlespacing*{\chapter} {0pt}{110pt}{20pt}

\input{title/title}

\ifshowfinalchecks{}
    \include{includes/aux/final_checks}
\fi


%%%%%%%%%%%%%%%%%%%%%%%%%%
% Front Matter:
%%%%%%%%%%%%%%%%%%%%%%%%%%

% ---------------------------------
% Dedication
% ---------------------------------

{\clearpage           % we want a new page
   \thispagestyle{empty}% no header and footer
   \vspace*{\stretch{1}}% some space at the top
   \itshape             % the text is in italics
   \begin{center}
       To the student
   \end{center}
}
{\par % end the paragraph
   \vspace{\stretch{3}} % space at bottom is three times that at the top
   \clearpage           % finish off the page
}


% ---------------------------------
% Other front matter
% ---------------------------------

\input{includes/frontmatter/acknowledgements}

\newpage

\input{includes/frontmatter/preface}

\newpage

\input{includes/frontmatter/prerequisites}

\newpage

\input{includes/frontmatter/notation}

\clearpage

% ---------------------------------
% Table of Contents
% ---------------------------------
\tableofcontents{
    \fancyhead[LO]{\slshape\contentsname}
    \fancyhead[RE]{\slshape\contentsname}
}

\clearpage{}

% ---------------------------------
% List of Figures
% ---------------------------------
\listoffigures{\fancyhead[LE]{\slshape\listfigurename}}
% \clearpage
% \listoftables{\fancyhead[LE]{\slshape\listtablename}}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Chapters:
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\mainmatter{}

% Chapter titles with numbers
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\sffamily}{}{25pt}{\chaptitle}
\titlespacing*{\chapter} {0pt}{110pt}{20pt}

% ==============================================
\input{chapters/qcd.tex}
% ==============================================
% The first chapter has no appendices (appendices add new line to toc automatically..?)
% so we add a new toc line manually here
\addnewlinetotoc{}
\clearpage{}

% ==============================================
\input{chapters/particles.tex}
% ==============================================

% ==============================================
\input{chapters/jets.tex}
% ==============================================

% ==============================================
\input{chapters/substructure.tex}
% ==============================================

% ==============================================
\input{chapters/event_shapes.tex}
% ==============================================


% =====================================
% Discussion and Conclusions:
% =====================================
% Avoiding unwanted blank pages between chapters
\begingroup{}
\renewcommand{\cleardoublepage}{}
\renewcommand{\clearpage}{}

% ==============================================
\input{chapters/conclusion.tex}
% ==============================================
% No appendices, so again we add a new toc line manually
\addnewlinetotoc{}
\newpage{}
\endgroup{}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Appendices
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{chapters/appendices.tex}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Back Matter
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\backmatter{}

% Chapter titles without numbers
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\sffamily}{}{25pt}{\chaptitlenonumber}
\titlespacing*{\chapter} {0pt}{110pt}{20pt}

\chapter[\bf Bonus Problems]{Bonus Problems}
\markboth{\bf Bonus Problems}{}
% =====================================
\input{chapters/bonus_problems.tex}
% =====================================
\addnewlinetotoc{}
\newpage{}


\chapter[\bf Solutions to Problems]{Solutions to Problems}
\markboth{\bf Solutions to Problems}{}
% =====================================
\input{chapters/solutions.tex}
% =====================================

\clearpage

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bibliography:
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Chapter titles without numbers
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\sffamily}{}{25pt}{\chaptitlenonumber}
\titlespacing*{\chapter} {0pt}{110pt}{20pt}

% New header
% \renewcommand\bibname{\bf Bibliography}
% DEBUG : is bibliography capitalized in the header?

\bibliography{thesis_bib}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Glossary
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Adding all terms to glossary
% (``unused'' means that entries added in this way will not have an associated page number)
\glsaddallunused{}

% Alternative with page number, I can't see ever wanting this though
% \glsaddall{}


% - - - - - - - - - - - - - - - - -
% Acronyms
% - - - - - - - - - - - - - - - - -
% Fixing appearance in TOC
\addnewlinetotoc{}

\printglossary[type=\acronymtype]


% - - - - - - - - - - - - - - - - -
% Glossary
% - - - - - - - - - - - - - - - - -
% Fixing appearance in TOC
\addnewlinetotoc{}

% Removing unwanted newpage
\clearpage
\begingroup\let\newpage\relax
\printglossary
\endgroup


% - - - - - - - - - - - - - - - - -
% Index
% - - - - - - - - - - - - - - - - -
% DEBUG: Do I even want an index?

% Fixing appearance in TOC
\addnewlinetotoc{}

% Removing unwanted newpage
\clearpage
\begingroup\let\newpage\relax
% \printunsrtglossary[type=index,style=bookindex] % index
\printindex
\endgroup

% DEBUG: not sure which command to use to generate index
% \printglossary[type=index,style=bookindex] % index
% \printindex


% TODOs (acronym/glossary/index):
% TODO: See wiki: Dual entries with reference to a glossary entry from an acronym
% TODO: Figure out how to add items to index as well
% See: https://tex.stackexchange.com/a/267345
% TODO: Link EEC and EWOC to Event Shape


% =====================================
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% =====================================
